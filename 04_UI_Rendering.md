
# Doc 4: UI/レンダリング仕様書 (先行策定: ビューア動作仕様) Ver 3.2

## 1. ビューアの基本構造 (Viewer Structure)

### 1.1 ビューエリア (View Area) の概念
*   **定義**: 画像を描画する論理的な矩形領域。「枠」や「境界線」は持たず、没入感を阻害しない。
*   **構成**:
    *   **Single Mode (初期)**: ウィンドウ全体を1つのビューエリアとする。
    *   **Split Mode (将来)**: ウィンドウを分割（左右など）し、複数のビューエリアを並列させる。境界線は描画しない（または極細のガイドのみ）。
*   **アクティブビュー**:
    *   常に「現在操作対象のビューエリア」が1つ存在する。
    *   **判定**: 最後にマウスホバー、またはクリックされたエリアがアクティブとなる。

### 1.2 没入型表示 (Immersive View)
*   **遷移**: ブラウザで `Enter` またはダブルクリック。
*   **背景色 (Background Color)**:
    *   画像のアスペクト比がビューエリアと一致しない場合に発生する余白の色。
    *   **設定候補**: 黒 (#000000), ダークグレー (#202020), 市松模様 (黒/灰, 白/灰), 白 (#FFFFFF), セピア/グリーン。
    *   **透過 (Transparent)**: ウィンドウ背景を透過させ、デスクトップを透かす。

### 1.3 オーバーレイUI (Overlay UI)
マウス移動、または特定キー押下時のみ一時表示し、操作がなければフェードアウトする。

#### A. 上部コントロールバー (Top Control Bar)
*   **左エリア (Info)**:
    *   ファイル名 (太字・ドロップシャドウ付きで視認性確保)。
    *   解像度 (例: 1920x1080)。
    *   ※ファイルサイズ等の詳細は省き、シンプルさを優先。
*   **中央エリア (Navigation)**:
    *   `<<` (先頭)
    *   `<` (前へ)
    *   `7 / 198` (現在位置 / 総数)
    *   `>` (次へ)
    *   `>>` (末尾)
    *   `▶` (スライドショー開始/停止)
*   **右エリア (Settings & Tools)**:
    *   表示モード切替 [1ページ/見開き/自動]
    *   サイズ切替 [等倍/フィット/幅合わせ]
    *   回転/反転 [左][右][左右反転]
    *   画質 [補間フィルタ]
    *   **比較 (Compare)**: [画面分割] ボタン（将来用）。
    *   設定 [歯車], ウィンドウ [全画面][閉じる]

#### B. 下部シークバー (Bottom Seek Bar)
*   **機能**: フォルダ内の現在位置を視覚化し、高速移動を提供する。
*   **挙動**:
    *   **位置表示**: インジケーターによる現在位置表示。
    *   **ドラッグ移動**: バーをドラッグしてフォルダ内を高速スクラブ移動。
    *   **マルチビュー時**:
        *   **独立モード**: アクティブなビューエリアのみ移動。
        *   **同期モード**: 全てのビューエリアを同時に移動（連番比較用）。
    *   **ホバープレビュー**: バー上のマウス位置にある画像をサムネイルポップアップ（実装Phase 2以降）。

## 2. 画像の配置とスケーリング (Placement & Scaling)

### 2.1 ビューエリアごとの状態管理
各ビューエリアは独立して以下の状態を持つ。
*   **表示ファイル**: パス、デコード済みテクスチャ。
*   **トランスフォーム**: ズーム率、パン位置（X,Y）、回転角度、反転状態。

### 2.2 初期表示位置
*   **Fit Mode**: ビューエリア内に収まるように縮小/拡大。
*   **Original Mode**: ドットバイドット。基準位置（左上/中央）は設定依存。

### 2.3 スナップと吸着 (Snapping)
*   **スナップ挙動**:
    *   画像をドラッグ/スクロール移動時、画像の端（Edge）がビューエリアの端に近づくと、**自動的に吸着（Snap）**する。
    *   これにより、黒帯を出さずに画像の端をぴったり表示する操作を支援する。

### 2.4 オーバースクロール (Overscroll)
スナップ状態でさらに外側へ移動しようとした場合の挙動。

*   **マウスドラッグ時**:
    *   **無抵抗モード (Free Pan)**: 画面端で止まらない。画像の端を画面中央まで持ってくることができる（細部確認用）。
*   **タッチスワイプ / ホイールスクロール時**:
    *   **抵抗モード (Resistance)**: 画面端で止まる（それ以上行かない）。
    *   **ページ送りモード (Smart Scroll)**: さらにスクロールすると、次の画像へ遷移する。

## 3. 移動・スクロールロジック (Navigation Logic)

### 3.1 スマートスクロール (Smart Scroll)
*   画像が収まっている場合 → ページめくり。
*   画像がはみ出している場合 → パン移動 → 端でページめくり。

### 3.2 N字スクロール (N-Type Scroll)
*   縦長画像をZ字/N字順序（左上→左下→右上→右下）で閲覧。

### 3.3 同期スクロール (Sync Scroll) - マルチビュー拡張
*   **機能**: 複数のビューエリアを表示中、一方の操作にもう一方を追従させる。
*   **モード**:
    *   **位置同期**: 同じ座標（%指定）を表示。
    *   **相対同期**: ズレを維持したまま移動（間違い探し用）。

## 4. 入力デバイスごとの挙動定義

### 4.1 マウス操作
*   **左ドラッグ**:
    *   **パン（掴み移動）**。
    *   **慣性なし**: 手の動きに1:1で追従し、離した瞬間に止まる。
    *   オーバースクロール：**無抵抗モード**。
*   **左クリック + ホイール**:
    *   **ズーム**（カーソル位置中心）。
*   **右クリック**:
    *   コンテキストメニュー表示。
*   **ホイール回転**:
    *   縦スクロール（または前後の画像へ移動）。
*   **チルトホイール**:
    *   横スクロール（またはフォルダ移動）。

### 4.2 キーボード操作
*   **Arrow / WASD / HJKL**: パン / 画像切替（スマートスクロール依存）。
*   **Ctrl + Arrow**: **10枚飛ばし**（設定可）。
*   **Shift + Arrow**: **20枚飛ばし**（設定可）。
*   **+ / -**: ズームイン / アウト。
*   **PgUp / PgDn**: ページ内縦移動（ページ送りはしない）。
*   **Home / End**: 先頭 / 末尾へ移動。
*   **Esc**: 戻る（ビューア終了）。
*   **Enter**: フルスクリーン切替（またはブラウザへ戻る）。
*   **Space**: スマートスクロール順送り。
*   **Shift + Space**: スマートスクロール逆送り。

### 4.3 タッチ操作
*   **スワイプ (1本指)**:
    *   パン移動。**慣性あり**。
    *   オーバースクロール：**ページ送りモード**（端で引っ張ると次へ）。
*   **ピンチイン/アウト (2本指)**:
    *   ズーム（指の中心）。
